<!doctype html>
<html lang="tr" data-theme="dark">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Morphera Admin Paneli</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>

/* =========================================================
      PREMIUM ADMIN PANEL CSS
      WeAreMorphera Gradient + Glassmorphism + Oval Cards
========================================================= */

/* LIGHT / DARK THEME ROOT */
:root {
  --bg-dark: #0c0d14;
  --bg-light: #f7f9fc;

  --card-dark: rgba(255,255,255,0.06);
  --card-light: rgba(255,255,255,0.5);

  --text-dark: #fff;
  --text-light: #111;

  --border-dark: rgba(255,255,255,0.16);
  --border-light: rgba(0,0,0,0.08);

  --gradient: linear-gradient(135deg, #6366f1, #8b5cf6, #ec4899);
  --gradient-soft: linear-gradient(160deg, rgba(99,102,241,0.38), rgba(236,72,153,0.32));
}

html[data-theme="dark"] {
  --bg: var(--bg-dark);
  --text: var(--text-dark);
  --card: var(--card-dark);
  --border: var(--border-dark);
}
html[data-theme="light"] {
  --bg: var(--bg-light);
  --text: var(--text-light);
  --card: var(--card-light);
  --border: var(--border-light);
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Inter", sans-serif;
}

/* NAVBAR */
.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 18px 40px;
  background: var(--card);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
}

.brand {
  display: flex;
  align-items: center;
  gap: 14px;
  font-weight: 700;
  font-size: 22px;
}
.brand img {
  width: 48px;
  filter: drop-shadow(0 0 12px rgba(99,102,241,0.4));
}

.theme-toggle {
  padding: 10px 20px;
  background: var(--gradient);
  border-radius: 14px;
  border: none;
  color: white;
  cursor: pointer;
  font-weight: 600;
}

/* MAIN LAYOUT */
.wrapper {
  display: grid;
  grid-template-columns: 260px auto;
  gap: 25px;
  padding: 30px;
}

/* SIDEBAR */
.sidebar {
  background: var(--card);
  padding: 25px;
  border-radius: 22px;
  border: 1px solid var(--border);
  height: calc(100vh - 140px);
  position: sticky;
  top: 20px;
}

.menu-item {
  padding: 14px;
  margin-bottom: 12px;
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 14px;
  cursor: pointer;
  font-weight: 500;
}
.menu-item:hover {
  background: var(--gradient-soft);
  color: white;
}

/* PANELS */
.panel {
  background: var(--card);
  border: 1px solid var(--border);
  padding: 28px;
  border-radius: 24px;
  display: none;
}
.panel.active {
  display: block;
}

h2 {
  margin-top: 0;
  margin-bottom: 16px;
}

/* INPUTS */
input, textarea {
  width: 100%;
  padding: 14px 16px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.1);
  color: var(--text);
  margin-bottom: 14px;
  font-size: 15px;
}
textarea { min-height: 120px; }

/* BUTTONS */
.btn-primary {
  background: var(--gradient);
  padding: 14px 26px;
  border-radius: 14px;
  border: none;
  color: white;
  font-weight: 600;
  cursor: pointer;
  font-size: 15px;
}

/* ANALYTICS CARDS */
.analytics {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 20px;
  margin-bottom: 25px;
}
.analytics-card {
  background: var(--card);
  padding: 20px;
  border-radius: 20px;
  border: 1px solid var(--border);
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  backdrop-filter: blur(15px);
}
.analytics-card span {
  display: block;
  font-size: 32px;
  margin-top: 8px;
  font-weight: 700;
  background: var(--gradient);
  -webkit-background-clip: text;
  color: transparent;
}

/* POSTS LIST */
.post-item {
  background: rgba(255,255,255,0.04);
  padding: 18px;
  border-radius: 18px;
  border: 1px solid var(--border);
  margin-bottom: 14px;
}
.post-actions button {
  margin-right: 10px;
  padding: 6px 12px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
.btn-edit { background:#0ea5e9; color:white; }
.btn-delete { background:#dc2626; color:white; }

/* PROFILE PREVIEW */
.profile-preview {
  padding: 20px;
  border-radius: 20px;
  background: rgba(255,255,255,0.08);
  border: 1px solid var(--border);
  margin-top: 14px;
}
.preview-cover {
  width: 100%;
  height: 160px;
  border-radius: 18px;
  object-fit: cover;
  border: 1px solid var(--border);
}
.preview-avatar {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  margin-top: -60px;
  border: 4px solid var(--bg);
  box-shadow: 0 0 12px rgba(0,0,0,0.4);
}

</style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <div class="brand">
    <img src="assets/img/logo/morphera.png">
    WeAreMorphera ‚Äì Admin Paneli
  </div>

  <button class="theme-toggle" id="themeToggle">üåó Tema Deƒüi≈ütir</button>
</div>

<div class="wrapper">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="menu-item" onclick="showPanel('analyticsPanel')">Analytics</div>
    <div class="menu-item" onclick="showPanel('profilePanel')">Profil Ayarlarƒ±</div>
    <div class="menu-item" onclick="showPanel('newPostPanel')">Yeni G√∂nderi</div>
    <div class="menu-item" onclick="showPanel('postsPanel')">G√∂nderiler</div>
  </aside>

  <!-- PANELS -->
  <div>

    <!-- ANALYTICS PANEL -->
    <div class="panel active" id="analyticsPanel">
      <h2>üìä Analytics</h2>

      <div class="analytics">
        <div class="analytics-card">
          Toplam G√∂nderi
          <span id="totalPosts">0</span>
        </div>
        <div class="analytics-card">
          Toplam Beƒüeni
          <span id="totalLikes">0</span>
        </div>
        <div class="analytics-card">
          Toplam Yorum
          <span id="totalComments">0</span>
        </div>
      </div>
    </div>

    <!-- PROFILE PANEL -->
    <div class="panel" id="profilePanel">
      <h2>Profil Ayarlarƒ±</h2>

      <label>Kapak Fotoƒürafƒ± URL</label>
      <input id="coverPhoto">

      <label>Profil Fotoƒürafƒ± URL</label>
      <input id="profilePhoto">

      <button class="btn-primary" id="saveProfile">Kaydet</button>

      <!-- PREVIEW -->
      <div class="profile-preview">
        <img id="coverPreview" class="preview-cover">
        <img id="avatarPreview" class="preview-avatar">
      </div>
    </div>

    <!-- NEW POST -->
    <div class="panel" id="newPostPanel">
      <h2>Yeni G√∂nderi</h2>

      <textarea id="postText" placeholder="G√∂nderi metni..."></textarea>
      <input id="postImage" placeholder="G√∂rsel URL (opsiyonel)">

      <button class="btn-primary" id="addPost">G√∂nderiyi Payla≈ü</button>
    </div>

    <!-- POSTS LIST -->
    <div class="panel" id="postsPanel">
      <h2>G√∂nderiler</h2>
      <div id="postsList"></div>
    </div>

  </div>

</div>



<!-- FIREBASE JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    getDoc,
    getDocs,
    setDoc,
    addDoc,
    updateDoc,
    deleteDoc,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  // === Firebase Config ===
  const firebaseConfig = {
    apiKey: "AIzaSyCoLU3FES5QdNoD1WOHz9M7Z01U63hkn4U",
    authDomain: "morpheranotes.firebaseapp.com",
    projectId: "morpheranotes",
    storageBucket: "morpheranotes.firebasestorage.app",
    messagingSenderId: "756772520204",
    appId: "1:756772520204:web:b686f9f69f860098a10929",
    measurementId: "G-CLH7TE7TNP"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  // koleksiyon referanslarƒ±
  const notesColRef    = collection(db, "morpheraNotes");
  const authorsColRef  = collection(db, "noteAuthors");

  // === Hangi admin giri≈ü yaptƒ±? (notes.html'den geldi) ===
  const username = localStorage.getItem("morpheraAdminUser");
  if (!username) {
    // g√ºvenlik i√ßin, login yoksa geri yolla
    window.location.href = "notes.html";
  }

  const authorDocRef = doc(authorsColRef, username);

  // ==== DOM referanslarƒ± (id'ler senin panel tasarƒ±mƒ±na g√∂re) ====
  const displayNameInput = document.getElementById("profileDisplayName");
  const titleInput       = document.getElementById("profileTitle");
  const avatarUrlInput   = document.getElementById("profileAvatarUrl");
  const coverUrlInput    = document.getElementById("profileCoverUrl");

  const avatarPreview    = document.getElementById("profileAvatarPreview");
  const coverPreview     = document.getElementById("profileCoverPreview");

  const profileForm      = document.getElementById("profileForm");

  const postForm         = document.getElementById("postForm");
  const postTextInput    = document.getElementById("postText");
  const postImageInput   = document.getElementById("postImageUrl");
  const postList         = document.getElementById("postList");

  // analytics kartlarƒ±
  const statPostsEl      = document.getElementById("statPosts");
  const statLikesEl      = document.getElementById("statLikes");
  const statCommentsEl   = document.getElementById("statComments");

  let currentProfile = null;

  // === Kullanƒ±cƒ±ya g√∂re default profil deƒüerleri ===
  function getDefaultProfile(username) {
    if (username === "bulutkeles") {
      return {
        displayName: "Bulut Kele≈ü",
        title: "Co-Founder ¬∑ Tech & Growth",
        avatarUrl: "",
        coverUrl: ""
      };
    }
    if (username === "busrakaraca") {
      return {
        displayName: "B√º≈üra Karaca",
        title: "Co-Founder ¬∑ Creative & Ops",
        avatarUrl: "",
        coverUrl: ""
      };
    }
    if (username === "eminekaraca") {
      return {
        displayName: "Emine Karaca",
        title: "Community & Content",
        avatarUrl: "",
        coverUrl: ""
      };
    }
    return {
      displayName: username,
      title: "",
      avatarUrl: "",
      coverUrl: ""
    };
  }

  // === Profil formunu ve √∂nizlemeyi doldur ===
  function fillProfileForm() {
    if (!currentProfile) return;
    displayNameInput.value = currentProfile.displayName || "";
    titleInput.value       = currentProfile.title || "";
    avatarUrlInput.value   = currentProfile.avatarUrl || "";
    coverUrlInput.value    = currentProfile.coverUrl || "";

    if (currentProfile.avatarUrl) {
      avatarPreview.style.backgroundImage = `url(${currentProfile.avatarUrl})`;
      avatarPreview.classList.add("has-image");
    } else {
      avatarPreview.style.backgroundImage = "none";
      avatarPreview.classList.remove("has-image");
    }

    if (currentProfile.coverUrl) {
      coverPreview.style.backgroundImage = `url(${currentProfile.coverUrl})`;
      coverPreview.classList.add("has-image");
    } else {
      coverPreview.style.backgroundImage = "none";
      coverPreview.classList.remove("has-image");
    }
  }

  // === Firestore'dan profil √ßek ===
  async function loadProfile() {
    const snap = await getDoc(authorDocRef);
    if (snap.exists()) {
      currentProfile = snap.data();
    } else {
      currentProfile = getDefaultProfile(username);
      await setDoc(authorDocRef, currentProfile, { merge: true });
    }
    fillProfileForm();
  }

  // === Profil kaydet ===
  profileForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    currentProfile = {
      displayName: (displayNameInput.value || username).trim(),
      title: (titleInput.value || "").trim(),
      avatarUrl: (avatarUrlInput.value || "").trim(),
      coverUrl: (coverUrlInput.value || "").trim()
    };

    await setDoc(authorDocRef, currentProfile, { merge: true });
    fillProfileForm();
    alert("Profil bilgilerin kaydedildi ‚úÖ");
  });

  // === Yeni g√∂nderi ekle ===
  postForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text  = postTextInput.value.trim();
    const image = postImageInput.value.trim();

    if (!text) return;

    // profil hen√ºz √ßekilmediyse √ßek
    if (!currentProfile) {
      await loadProfile();
    }

    const initials = (currentProfile.displayName || username)
      .split(" ")
      .map(p => p.charAt(0))
      .join("")
      .slice(0, 2)
      .toUpperCase();

    await addDoc(notesColRef, {
      text,
      imageUrl: image || "",
      createdAt: serverTimestamp(),

      // NOT: notes.html bunlarƒ± bekliyor
      authorKey: username,
      authorName: currentProfile.displayName || username,
      authorRole: currentProfile.title || "",
      authorInitials: initials,
      avatarBg: "var(--accent1)",      // istersen role'lere g√∂re deƒüi≈ütirebilirsin
      avatarUrl: currentProfile.avatarUrl || ""
    });

    postTextInput.value  = "";
    postImageInput.value = "";

    await Promise.all([loadAdminPosts(), loadAnalytics()]);
  });

  // === Admin g√∂nderilerini listele (isteƒüe baƒülƒ±, sadece panel i√ßin) ===
  async function loadAdminPosts() {
    const q = query(notesColRef, orderBy("createdAt", "desc"));
    const snap = await getDocs(q);

    const items = [];
    snap.forEach(docSnap => {
      const data = docSnap.data();
      if (data.authorKey !== username) return; // sadece kendi postlarƒ±nƒ± g√∂ster
      const date = data.createdAt?.toDate?.() || new Date();
      const ts = date.toLocaleString("tr-TR", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });

      items.push(`
        <article class="admin-post-card">
          <div class="admin-post-card__meta">
            <span class="admin-post-card__date">${ts}</span>
            <span class="admin-post-card__stats">
              ‚ù§Ô∏è ${data.likeCount || 0} ¬∑ üí¨ ${data.commentCount || 0}
            </span>
          </div>
          <p class="admin-post-card__text">${(data.text || "").replace(/\n/g,"<br>")}</p>
        </article>
      `);
    });

    if (postList) {
      postList.innerHTML = items.join("") || "<p>Hen√ºz bir g√∂nderin yok.</p>";
    }
  }

  // === Analytics: toplam g√∂nderi / beƒüeni / yorum ===
  async function loadAnalytics() {
    const snap = await getDocs(notesColRef);
    const notes = snap.docs;

    let totalPosts = notes.length;
    let totalLikes = 0;
    let totalComments = 0;

    await Promise.all(
      notes.map(async (docSnap) => {
        const id = docSnap.id;
        const likesSnap = await getDocs(collection(db, "morpheraNotes", id, "likes"));
        const commentsSnap = await getDocs(collection(db, "morpheraNotes", id, "comments"));
        totalLikes += likesSnap.size;
        totalComments += commentsSnap.size;
      })
    );

    if (statPostsEl)    statPostsEl.textContent    = totalPosts;
    if (statLikesEl)    statLikesEl.textContent    = totalLikes;
    if (statCommentsEl) statCommentsEl.textContent = totalComments;
  }

  // === Sayfa y√ºklenince her ≈üeyi ba≈ülat ===
  window.addEventListener("DOMContentLoaded", async () => {
    await loadProfile();
    await loadAdminPosts();
    await loadAnalytics();
  });
</script>


</body>
</html>
