<!doctype html>
<html lang="tr" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Morphera Admin Paneli</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
  /* =========================================================
        PREMIUM ADMIN PANEL CSS
        WeAreMorphera Gradient + Glassmorphism + Oval Cards
  ========================================================= */

  :root {
    --bg-dark: #0c0d14;
    --bg-light: #f7f9fc;

    --card-dark: rgba(255,255,255,0.06);
    --card-light: rgba(255,255,255,0.5);

    --text-dark: #ffffff;
    --text-light: #111111;

    --border-dark: rgba(255,255,255,0.16);
    --border-light: rgba(0,0,0,0.08);

    --gradient: linear-gradient(135deg,#6366f1,#8b5cf6,#ec4899);
    --gradient-soft: linear-gradient(160deg,rgba(99,102,241,0.35),rgba(236,72,153,0.28));
  }

  html[data-theme="dark"] {
    --bg: var(--bg-dark);
    --text: var(--text-dark);
    --card: var(--card-dark);
    --border: var(--border-dark);
  }
  html[data-theme="light"] {
    --bg: var(--bg-light);
    --text: var(--text-light);
    --card: var(--card-light);
    --border: var(--border-light);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    background: radial-gradient(circle at top left, #1e293b 0, #020617 40%, #000 100%);
    color: var(--text);
    font-family: "Inter",sans-serif;
  }

  /* NAVBAR */
  .navbar {
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:18px 40px;
    background:linear-gradient(120deg,rgba(15,23,42,0.9),rgba(15,23,42,0.7));
    backdrop-filter:blur(22px);
    border-bottom:1px solid rgba(148,163,184,0.35);
    box-shadow:0 18px 40px rgba(15,23,42,0.9);
    position:sticky;
    top:0;
    z-index:20;
  }
  .brand {
    display:flex;
    align-items:center;
    gap:14px;
    font-weight:700;
    font-size:22px;
  }
  .brand img {
    width:48px;
    height:48px;
    border-radius:18px;
    object-fit:cover;
    box-shadow:0 0 24px rgba(129,140,248,0.9);
  }
  .navbar-sub {
    font-size:13px;
    opacity:0.8;
  }

  .theme-toggle {
    padding:10px 22px;
    background:var(--gradient);
    border-radius:999px;
    border:none;
    color:#fff;
    cursor:pointer;
    font-weight:600;
    font-size:14px;
    display:flex;
    align-items:center;
    gap:8px;
    box-shadow:0 15px 30px rgba(79,70,229,0.65);
  }

  /* LAYOUT */
  .wrapper {
    display:grid;
    grid-template-columns:260px minmax(0,1fr);
    gap:24px;
    padding:26px 32px 40px;
  }

  /* SIDEBAR */
  .sidebar {
    background:rgba(15,23,42,0.9);
    border-radius:24px;
    padding:22px 18px;
    border:1px solid rgba(148,163,184,0.35);
    box-shadow:0 18px 40px rgba(15,23,42,0.95);
    height:calc(100vh - 120px);
    position:sticky;
    top:80px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .sidebar-title{
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:0.16em;
    color:#9ca3af;
    margin-bottom:8px;
  }

  .menu-item{
    padding:12px 14px;
    margin-bottom:6px;
    border-radius:16px;
    border:1px solid transparent;
    color:#e5e7eb;
    font-size:14px;
    font-weight:500;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:10px;
    transition:all .18s ease-out;
  }
  .menu-item span.icon{
    width:26px;
    height:26px;
    border-radius:999px;
    background:rgba(15,23,42,0.9);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:15px;
  }
  .menu-item:hover{
    background:rgba(30,64,175,0.35);
  }
  .menu-item.active{
    background:var(--gradient);
    border-color:rgba(248,250,252,0.4);
    box-shadow:0 15px 40px rgba(129,140,248,0.8);
  }

  /* PANELS */
  .panel{
    display:none;
    background:rgba(15,23,42,0.9);
    border-radius:26px;
    padding:24px 26px 30px;
    border:1px solid rgba(148,163,184,0.45);
    box-shadow:0 20px 40px rgba(15,23,42,1);
  }
  .panel.active{display:block;}

  .panel-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin-bottom:20px;
  }
  .panel-title{
    font-size:20px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .panel-title-badge{
    font-size:12px;
    padding:4px 10px;
    border-radius:999px;
    background:rgba(15,23,42,0.9);
    border:1px solid rgba(148,163,184,0.6);
    color:#e5e7eb;
  }

  /* ANALYTICS */
  .analytics-grid{
    display:grid;
    grid-template-columns:repeat(3,minmax(0,1fr));
    gap:18px;
  }
  .analytics-card{
    border-radius:22px;
    padding:18px 20px;
    background:radial-gradient(circle at top left,rgba(129,140,248,0.45),rgba(15,23,42,0.92));
    border:1px solid rgba(129,140,248,0.8);
    box-shadow:0 22px 50px rgba(55,65,81,0.9);
  }
  .analytics-label{
    font-size:14px;
    color:#e5e7eb;
  }
  .analytics-value{
    margin-top:6px;
    font-size:32px;
    font-weight:700;
    background:var(--gradient);
    -webkit-background-clip:text;
    color:transparent;
  }

  /* FORM GENEL */
  .form-grid{
    display:grid;
    grid-template-columns: minmax(0,2.2fr) minmax(0,1.8fr);
    gap:22px;
  }

  .field-group{
    margin-bottom:14px;
  }
  .field-label{
    display:block;
    font-size:13px;
    margin-bottom:6px;
    color:#e5e7eb;
  }
  input[type="text"],
  textarea{
    width:100%;
    padding:12px 14px;
    border-radius:14px;
    border:1px solid rgba(148,163,184,0.6);
    background:rgba(15,23,42,0.9);
    color:#e5e7eb;
    font-size:14px;
    outline:none;
  }
  textarea{
    min-height:120px;
    resize:vertical;
  }
  input:focus,
  textarea:focus{
    border-color:#818cf8;
    box-shadow:0 0 0 1px rgba(129,140,248,0.6);
  }

  .btn-primary{
    border:none;
    border-radius:999px;
    background:var(--gradient);
    color:#fff;
    padding:10px 22px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 18px 42px rgba(129,140,248,0.9);
  }

  /* PROFƒ∞L PREVIEW */
  .profile-preview{
    border-radius:22px;
    padding:14px 14px 18px;
    background:radial-gradient(circle at top left,rgba(129,140,248,0.25),rgba(15,23,42,0.96));
    border:1px solid rgba(148,163,184,0.7);
  }
  .profile-cover{
    width:100%;
    height:150px;
    border-radius:18px;
    background:linear-gradient(135deg,#6366f1,#8b5cf6,#ec4899);
    background-size:cover;
    background-position:center;
  }
  .profile-avatar{
    width:96px;
    height:96px;
    border-radius:999px;
    margin-top:-46px;
    border:4px solid #020617;
    background:#111827;
    background-size:cover;
    background-position:center;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#f9fafb;
    font-weight:700;
    font-size:30px;
    box-shadow:0 18px 40px rgba(15,23,42,1);
  }
  .profile-meta{
    margin-top:12px;
  }
  .profile-name{
    font-size:16px;
    font-weight:600;
  }
  .profile-title{
    font-size:13px;
    color:#cbd5f5;
  }

  /* G√ñNDERƒ∞ Lƒ∞STESƒ∞ */
  .admin-post-card{
    border-radius:18px;
    padding:14px 16px;
    margin-bottom:12px;
    background:rgba(15,23,42,0.95);
    border:1px solid rgba(148,163,184,0.6);
  }
  .admin-post-meta{
    display:flex;
    justify-content:space-between;
    font-size:12px;
    color:#9ca3af;
    margin-bottom:6px;
  }
  .admin-post-text{
    font-size:14px;
    color:#e5e7eb;
  }

  @media (max-width: 960px){
    .wrapper{
      grid-template-columns: minmax(0,1fr);
    }
    .sidebar{
      position:static;
      height:auto;
      flex-direction:row;
      overflow-x:auto;
    }
    .sidebar-title{display:none;}
  }
  </style>
</head>
<body>

<!-- NAVBAR -->
<header class="navbar">
  <div class="brand">
    <img src="assets/img/logo/morphera.png" alt="Morphera">
    <div>
      <div>WeAreMorphera ‚Äì Admin Paneli</div>
      <div class="navbar-sub">Morpheradan Notlar ¬∑ ƒ∞√ßerik & Profil Y√∂netimi</div>
    </div>
  </div>

  <button id="themeToggle" class="theme-toggle">
    üåó Tema Deƒüi≈ütir
  </button>
</header>

<main class="wrapper">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-title">Panel</div>

    <div class="menu-item active" data-panel="analyticsPanel" onclick="showPanel('analyticsPanel')">
      <span class="icon">üìä</span> Analytics
    </div>
    <div class="menu-item" data-panel="profilePanel" onclick="showPanel('profilePanel')">
      <span class="icon">üë§</span> Profil Ayarlarƒ±
    </div>
    <div class="menu-item" data-panel="newPostPanel" onclick="showPanel('newPostPanel')">
      <span class="icon">üìù</span> Yeni G√∂nderi
    </div>
    <div class="menu-item" data-panel="postsPanel" onclick="showPanel('postsPanel')">
      <span class="icon">üß±</span> G√∂nderiler
    </div>
  </aside>

  <!-- PANELS WRAPPER -->
  <section>

    <!-- ANALYTICS -->
    <section class="panel active" id="analyticsPanel">
      <div class="panel-header">
        <div class="panel-title">
          üìä Analytics
          <span class="panel-title-badge">Duvar √ñzeti</span>
        </div>
      </div>

      <div class="analytics-grid">
        <article class="analytics-card">
          <div class="analytics-label">Toplam G√∂nderi</div>
          <div class="analytics-value" id="statPosts">0</div>
        </article>

        <article class="analytics-card">
          <div class="analytics-label">Toplam Beƒüeni</div>
          <div class="analytics-value" id="statLikes">0</div>
        </article>

        <article class="analytics-card">
          <div class="analytics-label">Toplam Yorum</div>
          <div class="analytics-value" id="statComments">0</div>
        </article>
      </div>
    </section>

    <!-- PROFƒ∞L -->
       <!-- PROFƒ∞L -->
    <section class="panel" id="profilePanel">
      <div class="panel-header">
        <div class="panel-title">
          üë§ Profil Ayarlarƒ±
          <span class="panel-title-badge">Yazar Kartƒ±n</span>
        </div>
      </div>

      <div class="form-grid">
        <!-- FORM -->
        <form id="profileForm">
          <div class="field-group">
            <label class="field-label">Ad Soyad</label>
            <input id="profileDisplayName" type="text" placeholder="√ñrn: Bulut Kele≈ü">
          </div>

          <div class="field-group">
            <label class="field-label">√únvan / Rol</label>
            <input id="profileTitle" type="text" placeholder="Co-Founder ¬∑ Tech & Growth">
          </div>

          <div class="field-group">
            <label class="field-label">Profil Fotoƒürafƒ± (dosya y√ºkle)</label>
            <input id="profileAvatarFile" type="file" accept="image/*">
          </div>

          <div class="field-group">
            <label class="field-label">Kapak Fotoƒürafƒ± (dosya y√ºkle)</label>
            <input id="profileCoverFile" type="file" accept="image/*">
          </div>

          <button class="btn-primary" type="submit">Profili Kaydet</button>
        </form>

        <!-- PREVIEW -->
        <aside class="profile-preview">
          <div id="profileCoverPreview" class="profile-cover"></div>
          <div id="profileAvatarPreview" class="profile-avatar">WM</div>

          <div class="profile-meta">
            <div class="profile-name" id="previewName">WeAreMorphera</div>
            <div class="profile-title" id="previewTitle">Admin</div>
          </div>
        </aside>
      </div>
    </section>


    <!-- YENƒ∞ G√ñNDERƒ∞ -->
    <section class="panel" id="newPostPanel">
      <div class="panel-header">
        <div class="panel-title">
          üìù Yeni G√∂nderi
          <span class="panel-title-badge">Morpheradan Notlar</span>
        </div>
      </div>

      <form id="postForm">
        <div class="field-group">
          <label class="field-label">G√∂nderi Metni</label>
          <textarea id="postText" placeholder="Kƒ±sa, net, i√ßten bir not yaz..."></textarea>
        </div>

        <div class="field-group">
          <label class="field-label">G√∂rsel URL (opsiyonel)</label>
          <input id="postImageUrl" type="text" placeholder="https://... .webp / .jpg">
        </div>

        <button class="btn-primary" type="submit">G√∂nderiyi Payla≈ü</button>
      </form>
    </section>

    <!-- G√ñNDERƒ∞LER -->
    <section class="panel" id="postsPanel">
      <div class="panel-header">
        <div class="panel-title">
          üß± G√∂nderiler
          <span class="panel-title-badge">Sadece Senin Notlarƒ±n</span>
        </div>
      </div>

      <div id="postList"></div>
    </section>

  </section>
</main>

<!-- FIREBASE + PANEL JS -->
<!-- FIREBASE + ADMIN PANEL JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    getDoc,
    setDoc,
    addDoc,
    getDocs,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";

  /* ---------- Tema Toggle ---------- */
  const savedTheme = localStorage.getItem("morpheraAdminTheme") || "dark";
  document.documentElement.setAttribute("data-theme", savedTheme);

  const themeBtn = document.getElementById("themeToggle");
  if (themeBtn) {
    themeBtn.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") || "dark";
      const next = current === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("morpheraAdminTheme", next);
    });
  }

  /* ---------- Panel Deƒüi≈ütirme ---------- */
  const panels = document.querySelectorAll(".panel");
  const menuItems = document.querySelectorAll(".menu-item");

  window.showPanel = function(panelId) {
    panels.forEach(p => p.classList.toggle("active", p.id === panelId));
    menuItems.forEach(item => {
      item.classList.toggle("active", item.dataset.panel === panelId);
    });
  };

  /* ---------- Firebase ---------- */
  const firebaseConfig = {
  apiKey: "AIzaSyCoLU3FES5QdNoD1WOHz9M7Z01U63hkn4U",
  authDomain: "morpheranotes.firebaseapp.com",
  projectId: "morpheranotes",
  storageBucket: "morpheranotes.appspot.com",   // ‚úÖ DOƒûRUSU BU
  messagingSenderId: "756772520204",
  appId: "1:756772520204:web:b686f9f69f860098a10929",
  measurementId: "G-CLH7TE7TNP"
};

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);
  const storage = getStorage(app);

  const notesColRef   = collection(db, "morpheraNotes");
  const authorsColRef = collection(db, "noteAuthors");

  /* ---------- Giri≈ü yapan admin bilgisi ---------- */
  const username = localStorage.getItem("morpheraAdminUser");
  if (!username) {
    window.location.href = "notes.html";
  }

  const authorDocRef = doc(authorsColRef, username);

  /* ---------- DOM referanslarƒ± ---------- */
  const displayNameInput = document.getElementById("profileDisplayName");
  const titleInput       = document.getElementById("profileTitle");
  const avatarFileInput  = document.getElementById("profileAvatarFile");
  const coverFileInput   = document.getElementById("profileCoverFile");

  const avatarPreview    = document.getElementById("profileAvatarPreview");
  const coverPreview     = document.getElementById("profileCoverPreview");
  const previewName      = document.getElementById("previewName");
  const previewTitle     = document.getElementById("previewTitle");

  const profileForm      = document.getElementById("profileForm");

  const postForm         = document.getElementById("postForm");
  const postTextInput    = document.getElementById("postText");
  const postImageInput   = document.getElementById("postImageUrl");
  const postList         = document.getElementById("postList");

  const statPostsEl      = document.getElementById("statPosts");
  const statLikesEl      = document.getElementById("statLikes");
  const statCommentsEl   = document.getElementById("statComments");

  let currentProfile = null;

  function defaultProfile(username) {
    if (username === "bulutkeles") {
      return { displayName: "Bulut Kele≈ü", title: "Co-Founder ¬∑ Tech & Growth", avatarUrl: "", coverUrl: "" };
    }
    if (username === "busrakaraca") {
      return { displayName: "B√º≈üra Karaca", title: "Co-Founder ¬∑ Creative & Ops", avatarUrl: "", coverUrl: "" };
    }
    if (username === "eminekaraca") {
      return { displayName: "Emine Karaca", title: "Community & Content", avatarUrl: "", coverUrl: "" };
    }
    return { displayName: username, title: "", avatarUrl: "", coverUrl: "" };
  }

  function fillProfileForm() {
    if (!currentProfile) return;

    displayNameInput.value = currentProfile.displayName || "";
    titleInput.value       = currentProfile.title || "";

    const initials = (currentProfile.displayName || username)
      .split(" ")
      .map(p => p.charAt(0))
      .join("")
      .slice(0,2)
      .toUpperCase();

    if (currentProfile.coverUrl) {
      coverPreview.style.backgroundImage = `url(${currentProfile.coverUrl})`;
    } else {
      coverPreview.style.backgroundImage = "linear-gradient(135deg,#6366f1,#8b5cf6,#ec4899)";
    }

    if (currentProfile.avatarUrl) {
      avatarPreview.style.backgroundImage = `url(${currentProfile.avatarUrl})`;
      avatarPreview.textContent = "";
    } else {
      avatarPreview.style.backgroundImage = "none";
      avatarPreview.textContent = initials;
    }

    previewName.textContent  = currentProfile.displayName || username;
    previewTitle.textContent = currentProfile.title || "Morphera Admin";
  }

  async function loadProfile() {
    const snap = await getDoc(authorDocRef);
    if (snap.exists()) {
      currentProfile = snap.data();
    } else {
      currentProfile = defaultProfile(username);
      await setDoc(authorDocRef, currentProfile, { merge:true });
    }
    fillProfileForm();
  }

  // Se√ßilen dosyayƒ± Storage‚Äôa y√ºkleyip URL d√∂nen helper
  async function uploadIfSelected(fileInput, path, existingUrl) {
    const file = fileInput.files[0];
    if (!file) return existingUrl || "";
    const r = ref(storage, path);
    await uploadBytes(r, file);
    return await getDownloadURL(r);
  }

  /* ---------- Profil Kaydet ---------- */
   /* ---------- Profil Kaydet ---------- */
  profileForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    try {
      if (!currentProfile) {
        await loadProfile();
      }

      const newAvatarUrl = await uploadIfSelected(
        avatarFileInput,
        `authors/${username}/avatar_${Date.now()}`,
        currentProfile.avatarUrl
      );

      const newCoverUrl = await uploadIfSelected(
        coverFileInput,
        `authors/${username}/cover_${Date.now()}`,
        currentProfile.coverUrl
      );

      currentProfile = {
        displayName: (displayNameInput.value || username).trim(),
        title: (titleInput.value || "").trim(),
        avatarUrl: newAvatarUrl,
        coverUrl: newCoverUrl
      };

      await setDoc(authorDocRef, currentProfile, { merge:true });
      fillProfileForm();
      alert("Profil kaydedildi ‚úÖ");
    } catch (err) {
      console.error("Profil kaydedilirken hata:", err);
      alert("Profil kaydedilirken bir hata olu≈ütu: " + (err?.message || err));
    }
  });


  /* ---------- Yeni G√∂nderi ---------- */
  postForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text  = postTextInput.value.trim();
    const image = postImageInput.value.trim();
    if (!text) return;

    if (!currentProfile) { await loadProfile(); }

    const initials = (currentProfile.displayName || username)
      .split(" ")
      .map(p => p.charAt(0))
      .join("")
      .slice(0,2)
      .toUpperCase();

    await addDoc(notesColRef, {
      authorKey: username,
      authorName: currentProfile.displayName || username,
      authorRole: currentProfile.title || "",
      authorInitials: initials,
      avatarBg: "var(--accent1)",
      avatarUrl: currentProfile.avatarUrl || "",
      text,
      imageUrl: image || "",
      createdAt: serverTimestamp()
    });

    postTextInput.value  = "";
    postImageInput.value = "";

    await Promise.all([loadAdminPosts(), loadAnalytics()]);
    alert("G√∂nderi payla≈üƒ±ldƒ± ‚úÖ");
  });

  /* ---------- G√∂nderiler (sadece o admin) ---------- */
  async function loadAdminPosts() {
    const q = query(notesColRef, orderBy("createdAt","desc"));
    const snap = await getDocs(q);

    const list = [];
    snap.forEach(docSnap => {
      const data = docSnap.data();
      if (data.authorKey !== username) return;

      const date = data.createdAt?.toDate?.() || new Date();
      const ts = date.toLocaleString("tr-TR", {
        day:"2-digit", month:"2-digit", year:"numeric",
        hour:"2-digit", minute:"2-digit"
      });

      list.push(`
        <article class="admin-post-card">
          <div class="admin-post-meta">
            <span>${ts}</span>
            <span>‚ù§Ô∏è ${data.likeCount || 0} ¬∑ üí¨ ${data.commentCount || 0}</span>
          </div>
          <div class="admin-post-text">${(data.text || "").replace(/\n/g,"<br>")}</div>
        </article>
      `);
    });

    postList.innerHTML = list.join("") || "<p>Hen√ºz bir g√∂nderin yok.</p>";
  }

  /* ---------- Analytics ---------- */
  async function loadAnalytics() {
    const snap = await getDocs(notesColRef);
    const notes = snap.docs;

    let totalPosts = notes.length;
    let totalLikes = 0;
    let totalComments = 0;

    await Promise.all(
      notes.map(async (docSnap) => {
        const id = docSnap.id;
        const likesSnap = await getDocs(collection(db,"morpheraNotes",id,"likes"));
        const commentsSnap = await getDocs(collection(db,"morpheraNotes",id,"comments"));
        totalLikes    += likesSnap.size;
        totalComments += commentsSnap.size;
      })
    );

    statPostsEl.textContent    = totalPosts;
    statLikesEl.textContent    = totalLikes;
    statCommentsEl.textContent = totalComments;
  }

  /* ---------- ƒ∞lk y√ºkleme ---------- */
  window.addEventListener("DOMContentLoaded", async () => {
    await loadProfile();
    await loadAdminPosts();
    await loadAnalytics();
  });
</script>




</body>
</html>
